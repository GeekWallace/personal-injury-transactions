
<!DOCTYPE html>
<html>
<head>
  <title>Ninox Grid via Make Proxy</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { width: 100%; margin-top: 20px; }
    h2 { font-size: 24px; }
  </style>
</head>
<body>
  <h2>Select a Record to Edit</h2>
  <table id="ninoxTable" class="display"></table>

  <script>
    async function fetchData() {
      try {
        const response = await fetch('https://hook.us2.make.com/aepagnzieftg83djsradvhe7kckv9urv?patientid=97');
        const data = await response.json();

           const tableData = data.map(record => {
          const f = record.fields || {};
          return {
            recordNum:    f['Record Num'] || '',
            patientName:  f['Patient Name'] || '',
            entityType:   f['Entity Type'] || '',
            physicians:   f['Physicians'] || '',
            dos:          f['DoS'] || '',
            dateBilled:   f['Date Billed'] || '',
            clinic:       f['Clinic'] || '',
            firm:         f['Firm'] || '',
            caseRep:      f['Case Rep'] || '',
            itemCharge:   f['Item Charge'] || '',
            serviceDesc:  f['Full Service Description'] || ''
          };
        });
        
        $('#ninoxTable').DataTable({
          data: tableData,
          columns: [
            { data: 'patientName', title: 'Patient Name' },
            { data: 'physician', title: 'Physician' },
            { data: 'dos', title: 'Date of Service' },
            { data: 'itemCharge', title: 'Charge' },
            {
              data: null,
              title: 'Action',
              render: function(data) {
                return `<button onclick='selectRecord(${JSON.stringify(data)})'>Select</button>`;
              }
            }
          ]
        });

      } catch (err) {
        console.error("Failed to fetch data:", err);
        alert("Error loading data from server.");
      }
    }

    function selectRecord(data) {
      window.parent.postMessage(data, '*');
    }

    fetchData();
  </script>
</body>
</html>
